import { asyncTryCatch } from "../utils/asyncTryCatch.js";
import { sendErrorResponse } from "../utils/sendError.js";
import { parseCsvFile } from "../helpers/vulnerability.helper.js";
import vulnerabilityService from "../services/vulnerability.service.js";

const  vulnerabilityController = {};

vulnerabilityController.parseCsvVulnerability = asyncTryCatch(async (req, res)=>{
    if (!req.file) {
        return res.status(400).send(sendErrorResponse(400, "No Csv file uploaded"));
    }
    const data = await parseCsvFile(req.file);
    return res.status(data.status).send(data);

});

vulnerabilityController.addLinuxVulnerability = asyncTryCatch(async (req, res)=>{
    const data = req.body;
    const result = await vulnerabilityService.addLinuxVulnerability(data);
    return res.status(result.status).send(result);
});

vulnerabilityController.getLinux = asyncTryCatch(async (req, res)=>{
    const limit = Number(req.query.limit) || 10;
    const page = Number(req.query.page) || 0;
    const search = req.query.search?.trim() || '';

    const result = await vulnerabilityService.getLinux(page, limit, search);
    return res.status(result.status).json(result);
})

vulnerabilityController.deleteLinux = asyncTryCatch(async (req, res)=>{
    const linux_ids = req.body || [];
    const result = await vulnerabilityService.deleteLinux(linux_ids);
    return res.status(result.status).json(result);
})

vulnerabilityController.addWindowsVulnerability = asyncTryCatch(async (req, res)=>{
    const data = req.body;
    const result = await vulnerabilityService.addWindowsVulnerability(data);
    return res.status(result.status).send(result);
});

export default vulnerabilityController;